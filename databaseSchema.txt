-- DROP SCHEMA public;

CREATE SCHEMA public AUTHORIZATION pg_database_owner;

COMMENT ON SCHEMA public IS 'standard public schema';

-- DROP SEQUENCE public.departments_id_seq;

CREATE SEQUENCE public.departments_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.departments_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.departments_id_seq TO massindo;

-- DROP SEQUENCE public.divisions_id_seq;

CREATE SEQUENCE public.divisions_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.divisions_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.divisions_id_seq TO massindo;

-- DROP SEQUENCE public.items_id_seq;

CREATE SEQUENCE public.items_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.items_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.items_id_seq TO massindo;

-- DROP SEQUENCE public.positions_id_seq;

CREATE SEQUENCE public.positions_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.positions_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.positions_id_seq TO massindo;

-- DROP SEQUENCE public.problem_comments_id_seq;

CREATE SEQUENCE public.problem_comments_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.problem_comments_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.problem_comments_id_seq TO massindo;

-- DROP SEQUENCE public.production_log_problem_comments_id_seq;

CREATE SEQUENCE public.production_log_problem_comments_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.production_log_problem_comments_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.production_log_problem_comments_id_seq TO massindo;

-- DROP SEQUENCE public.production_logs_id_seq;

CREATE SEQUENCE public.production_logs_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 9223372036854775807
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.production_logs_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.production_logs_id_seq TO massindo;

-- DROP SEQUENCE public.shifts_id_seq;

CREATE SEQUENCE public.shifts_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.shifts_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.shifts_id_seq TO massindo;

-- DROP SEQUENCE public.sub_positions_id_seq;

CREATE SEQUENCE public.sub_positions_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.sub_positions_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.sub_positions_id_seq TO massindo;

-- DROP SEQUENCE public.suppliers_id_seq;

CREATE SEQUENCE public.suppliers_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.suppliers_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.suppliers_id_seq TO massindo;

-- DROP SEQUENCE public.workers_id_seq;

CREATE SEQUENCE public.workers_id_seq
	INCREMENT BY 1
	MINVALUE 1
	MAXVALUE 2147483647
	START 1
	CACHE 1
	NO CYCLE;

-- Permissions

ALTER SEQUENCE public.workers_id_seq OWNER TO massindo;
GRANT ALL ON SEQUENCE public.workers_id_seq TO massindo;
-- public.divisions definition

-- Drop table

-- DROP TABLE public.divisions;

CREATE TABLE public.divisions (
	id serial4 NOT NULL,
	code varchar(20) NOT NULL,
	"name" varchar(100) NOT NULL,
	CONSTRAINT divisions_code_key UNIQUE (code),
	CONSTRAINT divisions_name_key UNIQUE (name),
	CONSTRAINT divisions_pkey PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE public.divisions OWNER TO massindo;
GRANT ALL ON TABLE public.divisions TO massindo;


-- public.items definition

-- Drop table

-- DROP TABLE public.items;

CREATE TABLE public.items (
	id serial4 NOT NULL,
	item_number varchar(50) NOT NULL,
	item_name varchar(100) NULL,
	spec text NULL,
	CONSTRAINT items_item_number_key UNIQUE (item_number),
	CONSTRAINT items_pkey PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE public.items OWNER TO massindo;
GRANT ALL ON TABLE public.items TO massindo;


-- public.positions definition

-- Drop table

-- DROP TABLE public.positions;

CREATE TABLE public.positions (
	id serial4 NOT NULL,
	code varchar(20) NOT NULL,
	unit varchar(10) NOT NULL,
	CONSTRAINT positions_code_key UNIQUE (code),
	CONSTRAINT positions_pkey PRIMARY KEY (id),
	CONSTRAINT positions_unit_check CHECK (((unit)::text = ANY ((ARRAY['pcs'::character varying, 'lmbr'::character varying])::text[])))
);

-- Permissions

ALTER TABLE public.positions OWNER TO massindo;
GRANT ALL ON TABLE public.positions TO massindo;


-- public.problem_comments definition

-- Drop table

-- DROP TABLE public.problem_comments;

CREATE TABLE public.problem_comments (
	id serial4 NOT NULL,
	description varchar(255) NOT NULL,
	CONSTRAINT problem_comments_description_key UNIQUE (description),
	CONSTRAINT problem_comments_pkey PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE public.problem_comments OWNER TO massindo;
GRANT ALL ON TABLE public.problem_comments TO massindo;


-- public.shifts definition

-- Drop table

-- DROP TABLE public.shifts;

CREATE TABLE public.shifts (
	id serial4 NOT NULL,
	"name" varchar(20) NOT NULL,
	CONSTRAINT shifts_name_key UNIQUE (name),
	CONSTRAINT shifts_pkey PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE public.shifts OWNER TO massindo;
GRANT ALL ON TABLE public.shifts TO massindo;


-- public.suppliers definition

-- Drop table

-- DROP TABLE public.suppliers;

CREATE TABLE public.suppliers (
	id serial4 NOT NULL,
	"name" varchar(100) NOT NULL,
	CONSTRAINT suppliers_name_key UNIQUE (name),
	CONSTRAINT suppliers_pkey PRIMARY KEY (id)
);

-- Permissions

ALTER TABLE public.suppliers OWNER TO massindo;
GRANT ALL ON TABLE public.suppliers TO massindo;


-- public.departments definition

-- Drop table

-- DROP TABLE public.departments;

CREATE TABLE public.departments (
	id serial4 NOT NULL,
	division_id int4 NOT NULL,
	code varchar(20) NOT NULL,
	"name" varchar(100) NOT NULL,
	CONSTRAINT departments_division_code_unique UNIQUE (division_id, code),
	CONSTRAINT departments_pkey PRIMARY KEY (id),
	CONSTRAINT departments_division_fk FOREIGN KEY (division_id) REFERENCES public.divisions(id) ON DELETE RESTRICT
);

-- Permissions

ALTER TABLE public.departments OWNER TO massindo;
GRANT ALL ON TABLE public.departments TO massindo;


-- public.sub_positions definition

-- Drop table

-- DROP TABLE public.sub_positions;

CREATE TABLE public.sub_positions (
	id serial4 NOT NULL,
	position_id int4 NOT NULL,
	code varchar(30) NOT NULL,
	CONSTRAINT sub_positions_pkey PRIMARY KEY (id),
	CONSTRAINT sub_positions_position_id_code_key UNIQUE (position_id, code),
	CONSTRAINT fk_sub_position_position FOREIGN KEY (position_id) REFERENCES public.positions(id) ON DELETE RESTRICT
);

-- Permissions

ALTER TABLE public.sub_positions OWNER TO massindo;
GRANT ALL ON TABLE public.sub_positions TO massindo;


-- public.workers definition

-- Drop table

-- DROP TABLE public.workers;

CREATE TABLE public.workers (
	id serial4 NOT NULL,
	"name" varchar(100) NOT NULL,
	position_id int4 NULL,
	department_id int4 NULL,
	CONSTRAINT workers_pkey PRIMARY KEY (id),
	CONSTRAINT workers_department_fk FOREIGN KEY (department_id) REFERENCES public.departments(id) ON DELETE RESTRICT
);

-- Permissions

ALTER TABLE public.workers OWNER TO massindo;
GRANT ALL ON TABLE public.workers TO massindo;


-- public.production_logs definition

-- Drop table

-- DROP TABLE public.production_logs;

CREATE TABLE public.production_logs (
	id bigserial NOT NULL,
	worker_id int4 NOT NULL,
	position_id int4 NOT NULL,
	sub_position_id int4 NULL,
	shift_id int4 NOT NULL,
	supplier_id int4 NULL,
	item_id int4 NOT NULL,
	qty_output numeric(10, 2) NOT NULL,
	qty_reject numeric(10, 2) NOT NULL,
	problem_duration_minutes int4 NULL,
	created_at timestamp DEFAULT CURRENT_TIMESTAMP NOT NULL,
	approved_coordinator bool NULL,
	approved_spv bool NULL,
	approved_coordinator_at timestamp NULL,
	approved_spv_at timestamp NULL,
	approved_coordinator_by int4 NULL,
	approved_spv_by int4 NULL,
	CONSTRAINT production_logs_pkey PRIMARY KEY (id),
	CONSTRAINT production_logs_problem_duration_minutes_check CHECK ((problem_duration_minutes >= 0)),
	CONSTRAINT production_logs_qty_output_check CHECK ((qty_output >= (0)::numeric)),
	CONSTRAINT production_logs_qty_reject_check CHECK ((qty_reject >= (0)::numeric)),
	CONSTRAINT spv_after_coordinator_check CHECK (((approved_spv IS NULL) OR (approved_coordinator = true))),
	CONSTRAINT fk_approved_coordinator_by FOREIGN KEY (approved_coordinator_by) REFERENCES public.workers(id),
	CONSTRAINT fk_approved_spv_by FOREIGN KEY (approved_spv_by) REFERENCES public.workers(id),
	CONSTRAINT fk_item FOREIGN KEY (item_id) REFERENCES public.items(id),
	CONSTRAINT fk_position FOREIGN KEY (position_id) REFERENCES public.positions(id),
	CONSTRAINT fk_shift FOREIGN KEY (shift_id) REFERENCES public.shifts(id),
	CONSTRAINT fk_sub_position FOREIGN KEY (sub_position_id) REFERENCES public.sub_positions(id),
	CONSTRAINT fk_supplier FOREIGN KEY (supplier_id) REFERENCES public.suppliers(id),
	CONSTRAINT fk_worker FOREIGN KEY (worker_id) REFERENCES public.workers(id)
);

-- Permissions

ALTER TABLE public.production_logs OWNER TO massindo;
GRANT ALL ON TABLE public.production_logs TO massindo;


-- public.production_log_problem_comments definition

-- Drop table

-- DROP TABLE public.production_log_problem_comments;

CREATE TABLE public.production_log_problem_comments (
	id serial4 NOT NULL,
	production_log_id int4 NOT NULL,
	problem_comment_id int4 NOT NULL,
	CONSTRAINT plpc_unique UNIQUE (production_log_id, problem_comment_id),
	CONSTRAINT production_log_problem_comments_pkey PRIMARY KEY (id),
	CONSTRAINT fk_plpc_problem_comment FOREIGN KEY (problem_comment_id) REFERENCES public.problem_comments(id) ON DELETE RESTRICT,
	CONSTRAINT fk_plpc_production_log FOREIGN KEY (production_log_id) REFERENCES public.production_logs(id) ON DELETE CASCADE
);

-- Permissions

ALTER TABLE public.production_log_problem_comments OWNER TO massindo;
GRANT ALL ON TABLE public.production_log_problem_comments TO massindo;




-- Permissions

GRANT ALL ON SCHEMA public TO pg_database_owner;
GRANT USAGE ON SCHEMA public TO public;